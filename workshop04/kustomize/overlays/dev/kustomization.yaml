apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# what files to allow for customization
resources:
- ../../base

# creates a new namespace
namespace: dev-ns

# add prefix to all resources under the specified namespace
namePrefix: dev-

# add labels
labels:
- pairs:
    env: dev
  includeSelectors: true # labels will be included in selectors
  includeTemplates: true # labels will be included in templates

# change replicas
replicas:
- name: dov-deploy
  count: 1

# change images
images:
- name: chukmunnlee/dov-bear
  # newName: fred/bear
  # newTag: v2.0.0-alpha
  newTag: v5

configMapGenerator:
- name: dov-cm
  # when specifying create behavior, do not include another config.yaml resource
  # when specifying merge/replace behavior, must include a config.yaml resource to incur the changes on
  behavior: create
  literals:
  - INSTANCE_NAME="configmap generated by kustomize"

secretGenerator:
- name: dov-secret
  behavior: create
  # no need to convert to base 64 (automatic conversion)
  literals:
  - API_KEY=my-api-key
  - INSTANCE_HASH=abcd1234

# patching (from JSON)
patches:
  # cannot patch the same resource more than once (in 1 kustomization.yaml file)
- target:
    group: apps
    version: v1
    kind: Deployment
    name: dov-deploy
  path: patch.yaml # link to patch.yaml to apply patches

# replacement (able to retrieve certain runtime data after the resource(s) is/are generated)
# replacements:
# - source:
#     kind: Service
#     name: app-svc
#     fieldPath: metadata.name
#   targets:
#   - select:
#       kind: Ingress
#       name: app-ing
#     fieldPaths:
#     # [host=acme.com] selects the specific host acme.com
#     - spec.rules.[host=acme.com].http.paths.[path=/].backend.service.name